name: Flutter WorkFlow

on:
  push:
   branches: [dev]
    
  pull_request: 
    types: [opened, edited, reopened, synchronize]
    branches: 
     - 'release/*'
     - 'dev*'
     - 'fix/*'
     - 'task/*'
     - 'bug/*'
     - 'feature/*'
     - 'story/*'
     - 'epic/*'
     - 'dev*'

jobs:
  build:
    # runs-on: macos-latest
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # - name: Install Java
      #   uses: actions/setup-java@v2
      #   with:
      #     distribution: 'zulu'
      #     java-version: '11'

      # - name: Install Flutter
      #   uses: subosito/flutter-action@v2
      #   with:
      #     flutter-version: '3.0.1'
      #     channel: 'stable'
      
      # - name: Flutter Doctor
      #   run: flutter doctor -v
        
      # - name: Install dependencies
      #   run: flutter pub get

      # - name: Run Integration Tests
      #   uses: reactivecircus/android-emulator-runner@v2
      #   with:
      #     api-level: 31
      #     target: google_atd
      #     script: flutter drive --target=test_driver/main.dart --driver=test_driver/main_test.dart

      # - name: Upload Screenshoots
      #   uses: peter-evans/create-or-update-comment@v2
      #   with:
      #     issue-number: ${{github.event.pull_request.number}}
      #     body: echo $(./github/scripts/generate-markdown.sh)

      - name: Run echo path
        id: run_path
        run: cd .github/ && ls && cd scripts && ls && sudo bash generate-markdown.sh

    
      # - name: Just empty comment
      #   uses: peter-evans/find-comment@v1
      #   id: fc
      #   with:
      #     issue-number: ${{ github.event.pull_request.number }}
      #     comment-author: 'github-actions[bot]'
      #     body-includes: This comment was written by a bot!

      # - name: Make a comment
      #   uses: peter-evans/create-or-update-comment@v2
      #   body: ${{ steps.run_path.outputs.result }}
      #   with:
      #     token: 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 #${{ secrets.PAT }}
      
      #upload artifacts
      # - uses: actions/upload-artifact@v3
      #   with:
      #     name: my-artifact
      #     path: test/failures/
      - uses: actions/upload-artifact@v2-preview
        id: upload_artifacts
        with:
          name: cypress-screenshots
          path: test/failures/*.png
          
      # - name: Upload a folder with multiple files
      #   uses: devicons/public-upload-to-imgur@main
      #   id: images_uploads
      #   with:
      #     path: test/failures/
      #     client_id: ${{secrets.IMGUR_CLIENT_ID}}
      # - name: Add reaction
      #   uses: peter-evans/create-or-update-comment@v2
      #   with:
      #     comment-id: 322432 #${{ github.event.comment.id }}
      #     reactions: eyes

      # - name: Find Comment
      #   uses: peter-evans/find-comment@v2
      #   id: fc
      #   with:
      #     issue-number: ${{ github.event.pull_request.number }}
      #     comment-author: 'github-actions[bot]'
      #     body-includes: Build output

      - name: Create or update comment
        uses: peter-evans/create-or-update-comment@v2
        with:
          # body: ${{ steps.images_uploads.outputs.imgur_urls }}
          # comment-id: ${{ steps.fc.outputs.comment-id }}
          issue-number: 1 #${{ github.event.pull_request.number }}
          body: |
            Commit hello message
            ${{ steps.run_path.outputs.result }}
            ${{ steps.upload_artifacts.outputs.result }}
          # token: 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 #${{ secrets.PAT }}
          edit-mode: replace
            
        
